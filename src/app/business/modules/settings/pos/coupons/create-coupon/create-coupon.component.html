<section class="">
    <div class="card title-gb rounded-0">
      <h5 class="mgn-up-10">
        <span class="fa fa-arrow-left pointer-cursor"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Create Coupon
      </h5>
    </div>
  </section>
  <section>

    <!--begin::Entry-->
    <div class="d-flex flex-column-fluid">
      <!--begin::Container-->
      <div class=" container ">
        <div class="card card-custom">
          <div class="card-body p-0">
            <!--begin: Wizard-->
            <div class="wizard wizard-3">
              <!--begin: Wizard Nav-->
              <div class="wizard-nav">
                <div class="wizard-steps px-8 py-8 px-lg-15 py-lg-3">
                  <!--begin::Wizard Step 1 Nav-->
                  <div class="wizard-step">
                    <div class="wizard-label">
                      <h3 class="wizard-title">
                        <span>1.</span> Basic Info
                      </h3>
                      <div class="wizard-bar"></div>
                    </div>
                  </div>
                  <!--end::Wizard Step 1 Nav-->

                  <!--begin::Wizard Step 2 Nav-->
                  <div class="wizard-step">
                    <div class="wizard-label">
                      <h3 class="wizard-title">
                        <span>2.</span> Rules & Validity
                      </h3>
                      <div class="wizard-bar"></div>
                    </div>
                  </div>
                  <!--end::Wizard Step 2 Nav-->

                  <!--begin::Wizard Step 3 Nav-->
                  <div class="wizard-step">
                    <div class="wizard-label">
                      <h3 class="wizard-title">
                        <span>3.</span> Applicable For
                      </h3>
                      <div class="wizard-bar"></div>
                    </div>
                  </div>
                  <!--end::Wizard Step 3 Nav-->



                </div>
              </div>
              <!--end: Wizard Nav-->

              <!--begin: Wizard Body-->
              <div class="row justify-content-center py-10 px-8 py-lg-12 px-lg-10">
                <div class="col-xl-12 col-xxl-7">
                  <!--begin: Wizard Form-->
                  <form [formGroup]="couponForm" novalidate (ngSubmit)="onSubmit()" (keyup)="resetApiErrors()"
                    class="form">
                    <!--begin: Wizard Step 1-->
                    <div class="pb-5" *ngIf="step == 1">
                      <h4 class="mb-10 font-weight-bold text-dark">Basic Info</h4>
                      <div class="row">
                        <div class="col-xl-6">
                          <!--begin::Input-->
                          <div class="form-group">
                            <label>Coupon Name</label>
                            <input type="text" class="form-control1 form-control-solid form-control-lg" id="name" placeholder="Coupon Name*" formControlName="name"
                              maxlength="50" />
                            <!-- <app-field-error-display [displayError]="fed_service.isFieldValid(couponForm,'couponName')" [errorMsgs]="fed_service.getErrorMessage(couponForm,'couponName',
          {
          'required' : 'Enter your  coupon name',
          'maxlength' : 'Coupon Name can contain only ' + maxChars + ' characters'
          })">
                            </app-field-error-display> -->
                          </div>
                          <!--end::Input-->
                        </div>
                        <div class="col-xl-6">
                          <!--begin::Input-->
                          <div class="form-group">
                            <label>Coupon Code</label>
                            <input type="text" class="form-control1 form-control-solid form-control-lg" id="couponCode" placeholder="Coupon Code*" formControlName="couponCode"
                              maxlength="50" />
                            <!-- <app-field-error-display [displayError]="fed_service.isFieldValid(couponForm,'couponCode')" [errorMsgs]="fed_service.getErrorMessage(couponForm,'couponCode',
      {
      'required' : 'Enter your coupon code',
      'maxlength' : 'Coupon code can contain only ' + maxChars + ' characters'
      })">
                        </app-field-error-display> -->
                          </div>
                          <!--end::Input-->
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-xl-12">
                          <!--begin::Input-->
                          <div class="form-group">
                            <label>Calulation Type&nbsp;&nbsp;</label>
                            <mat-radio-group formControlName="calculationType" (change)="handleCalculationType($event)">
                              <mat-radio-button value="Fixed">Fixed</mat-radio-button>&nbsp;&nbsp;
                              <mat-radio-button value="Percentage">Percentage</mat-radio-button>
                            </mat-radio-group>
                          </div>
                          <!--end::Input-->
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-xl-6 ml-5">
                          <!--begin::Input-->
                          <div class="form-group">
                            <label>Coupon Amount</label>
                            <input type="text" class="form-control1 form-control-solid form-control-lg" id="amount" placeholder="Coupon Amount" formControlName="amount"
                            />
                          </div>
                          <!--end::Input-->
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-xl-12">
                          <!--begin::Input-->
                          <div class="form-group">
                            <label>Coupon Description</label>
                            <textarea type="text" class="form-control1 form-control-solid form-control-lg" id="description" placeholder="Enter coupon description"
                              formControlName="description" (keyup)="setCharCount()" (focus)="setDescFocus()" (blur)="lostDescFocus()"
                              maxlength="500"></textarea>
                            <!-- <app-field-error-display [displayError]="fed_service.isFieldValid(couponForm,'couponDesc')"
                              [errorMsgs]="fed_service.getErrorMessage(couponForm,'couponDesc',
                            {
                            'required' : 'Enter coupon description.',
                            'maxlength' : 'Coupon description can contain only ' + maxCharslong + ' characters'
                            })">
                            </app-field-error-display> -->
                            <span class="max-char-length" *ngIf="isfocused">You have {{char_count}} characters remaining</span>
                          </div>
                          <!--end::Input-->
                        </div>
                      </div>



                    </div>
                    <!--end: Wizard Step 1-->

                    <!--begin: Wizard Step 2-->
                    <div class="pb-5" *ngIf="step == 2" formGroupName="couponRules">
                      <h4 class="mb-10 font-weight-bold text-dark">Set Rules for this coupon</h4>
                      <div class="row">
                        <div class="col-xl-6">
                          <!--begin::Input-->
                          <div class="form-group">
                            <div class="input-group date">
                              <label>Valid From</label>
                              <input class="form-control1" type="date" (dateChange)="compareDate($event.value,0)" placeholder="Valid From" formControlName="startDate"
                              />
                            </div>
                          </div>
                          <!--end::Input-->
                        </div>
                        <div class="col-xl-6">
                          <!--begin::Input-->
                          <div class="form-group">
                            <div class="input-group date">
                              <label>Valid To</label>
                              <input class="form-control1" type="date" (dateChange)="compareDate($event.value,1)" placeholder="Valid To" formControlName="endDate"
                              />
                            </div>
                          </div>
                          <!--end::Input-->
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-xl-12">
                          <div class="form-group">
                            <label>Applicable Timings</label>
                            <div *ngFor="let wday of weekdays; index as i">
                              <mat-checkbox class="example-margin" *ngIf="i>0" (change)="handleDaychange(i)">{{wday}}
                              </mat-checkbox>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-xl-6">
                          <!--begin::Input-->
                          <div class="form-group">
                            <label>Available timewindow(s)</label>&nbsp;
                            <a class="pointlist" *ngIf="timewindow_list.length > 0" (click)="showTimewindow()">
                              <i class="fa fa-plus" aria-hidden="true"></i>
                            </a>
                            <div *ngIf="timewindow_list.length == 0">
                              Currently no timewindows are added&nbsp;
                              <a class="pointlist" (click)="showTimewindow()">Add</a>
                            </div>
                            <div *ngIf="timewindow_list.length > 0">
                              <ul *ngFor="let window of timewindow_list;let i = index">
                                <li>
                                  {{window.sTime}} - {{window.eTime}}&nbsp;
                                  <a class="pointlist" (click)="deletetimeslot(i)">
                                    <i class="fa fa-trash" aria-hidden="true"></i>
                                  </a>
                                </li>
                              </ul>
                            </div>
                          </div>
                          <!--end::Input-->
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-xl-12">
                          <div class="form-group">
                            <mat-checkbox class="example-margin" formControlName="firstCheckinOnly">Limit No of Coupons for first booking only
                            </mat-checkbox>
                          </div>
                        </div>



                      </div>
                      <div class="row">
                        <div class="col-xl-12">

                          <div class="form-group">
                            <mat-checkbox class="example-margin" formControlName="isproviderAcceptCoupon"> Limit # coupons provider can accept
                            </mat-checkbox>
                          </div>
                        </div>
                      </div>
                      <div class="row"[hidden]="this.couponForm.get('couponRules').get('isproviderAcceptCoupon').value==false">
                        <div class="col-xl-3 col-md-4">
                          <label>Max Number of Coupons</label>
                          <input type="text" class="form-control1 form-control-solid form-control-lg" id="amount" placeholder="Max coupon apply limit"
                            formControlName="maxProviderUseLimit" />
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-xl-6 col-md-6">
                          <div class="form-group">
                            <label>Minimum Bill Amount</label>
                            <input type="text" class="form-control1 form-control-solid form-control-lg" id="couponCode" placeholder="
                            Enter minimum bill amount" formControlName="minBillAmount"
                              maxlength="50" />
                          </div>
                        </div>
                        <div class="col-xl-6 col-md-6">
                          <div class="form-group">
                            <label>Maximum Discount value</label>
                            <input type="text" class="form-control1 form-control-solid form-control-lg" id="maxDiscountValue" placeholder="Enter discount value"
                              formControlName="maxDiscountValue" maxlength="50" />
                          </div>
                        </div>
                      </div>
                    </div>
                    <!--end: Wizard Step 2-->

                    <!--begin: Wizard Step 3-->
                    <div class="pb-5" *ngIf="step==3" >

                      <h4 class="mb-10 font-weight-bold text-dark">Apply this coupon to</h4>
                      <div formGroupName="couponRules">
                      <div formGroupName="policies">
                      <div class="row">
                        <div class="col-xl-12">
                          <div class="form-group">
                            <mat-checkbox class="example-margin" formControlName="isServiceBased">Limit coupon to Services
                            </mat-checkbox>
                          </div>
                        </div>



                      </div>
                      <div class="row" [hidden]="this.couponForm.get('couponRules').get('policies').get('isServiceBased').value==false">
                          <div class="col-xl-12">
                            <div class="form-group">
                                <button mat-raised-button  class="dialogbtn" (click)="openServiceDialog()">Services</button>

                            </div>
                            <p *ngIf="services.length>0">
                              {{ services.length }} Services Selected
                            </p>
                          </div>
                        </div>


                        <div [hidden]="this.couponForm.get('couponRules').get('policies').get('isServiceBased').value==false || active_user.type!=='BRANCH'">
                      <div class="row">
                        <div class="col-xl-12">
                          <div class="form-group">
                            <mat-checkbox   class="example-margin" formControlName="isDepartment">Limit coupon to Department Specific
                            </mat-checkbox>
                          </div>
                        </div>
                        </div>
                        <div class="row" [hidden]="this.couponForm.get('couponRules').get('policies').get('isServiceBased').value==false || this.couponForm.get('couponRules').get('policies').get('isDepartment').value==false">
                          <div class="col-xl-12">
                            <div class="form-group">
                                <button mat-raised-button  class="dialogbtn" (click)="openDepartmentDialog()">Departments</button>

                            </div>
                            <p *ngIf="departments.length>0">
                              {{ departments.length }} Departments Selected
                            </p>
                          </div>
                        </div>


                      </div>
                      <div [hidden]="this.couponForm.get('couponRules').get('policies').get('isServiceBased').value==false  || active_user.type!=='BRANCH'">
                      <div class="row">
                        <div class="col-xl-12">
                          <div class="form-group">
                            <mat-checkbox  class="example-margin" formControlName="isUser">Limit coupon to user Specific
                            </mat-checkbox>
                          </div>
                        </div>
                        <div class="row" [hidden]="this.couponForm.get('couponRules').get('policies').get('isUser').value==false">
                          <div class="col-xl-12">
                            <div class="form-group">
                                <button mat-raised-button  class="dialogbtn" (click)="openUserDialog()">Users</button>

                            </div>
                            <p *ngIf="users.length>0">
                              {{ users.length }} Users Selected
                            </p>
                          </div>
                        </div>


                      </div>
                      </div>
                      <div [hidden]="this.couponForm.get('couponRules').get('policies').get('isServiceBased').value==false">
                      <div class="row" >
                        <div class="col-xl-12">
                          <div class="form-group">
                            <mat-checkbox  class="example-margin" formControlName="isCustomerLabel">Limit coupon to
                              consumer Labels
                            </mat-checkbox>
                          </div>
                        </div>

                        <div class="row" [hidden]="this.couponForm.get('couponRules').get('policies').get('isCustomerLabel').value==false">
                          <div class="col-xl-12">
                            <div class="form-group">
                                <button mat-raised-button  class="dialogbtn" (click)="openCustomerLabelDialog()">Customer Labels</button>

                            </div>
                            <p *ngIf="customer_labels.length>0">
                              {{ customer_labels.length }} Labels Selected
                            </p>
                          </div>
                        </div>

                      </div>
                    </div>
                    <div [hidden]="this.couponForm.get('couponRules').get('policies').get('isServiceBased').value==false">
                      <div class="row">
                          <div class="col-xl-12">
                            <div class="form-group">
                              <mat-checkbox  class="example-margin" formControlName="isCustomerGroup">Limit coupon to
                                consumer Groups
                              </mat-checkbox>
                            </div>
                          </div>



                        </div>
                        <div class="row" [hidden]="this.couponForm.get('couponRules').get('policies').get('isCustomerGroup').value==false">
                          <div class="col-xl-12">
                            <div class="form-group">
                                <button mat-raised-button  class="dialogbtn" (click)="openCustomerGroupDialog()">Customer Groups</button>

                            </div>
                            <p *ngIf="customer_groups.length>0">
                              {{ customer_groups.length }} Groups Selected
                            </p>
                          </div>
                        </div>
                        </div>



                      <div class="row" >
                        <div class="col-xl-12">
                          <div class="form-group">
                            <mat-checkbox  class="example-margin" formControlName="isCatalogBased">Limit coupon to
                              Catalog
                            </mat-checkbox>
                          </div>
                        </div>



                      </div>

                        <div class="row" [hidden]="this.couponForm.get('couponRules').get('policies').get('isCatalogBased').value==false">
                          <div class="col-xl-12">
                            <div class="form-group">
                              <mat-form-field appearance="fill">
                                <label>Catalogue</label>
                                <mat-select placeholder="Catalogue" formControlName="catalogues" [multiple]="true">
                                  <mat-option *ngFor=" let catalog of catalog_list" [value]="catalog.catalogName">
                                    {{catalog.catalogName}}
                                  </mat-option>

                                </mat-select>
                              </mat-form-field>

                            </div>
                          </div>
                        </div>

                        <div class="row">
                          <div class="col-xl-12">
                            <div class="form-group">
                              <mat-checkbox  class="example-margin" formControlName="isItem">Limit coupon to
                                Items
                              </mat-checkbox>
                            </div>

                          </div>



                        </div>
                            <div class="row" [hidden]="this.couponForm.get('couponRules').get('policies').get('isItem').value==false">
                              <div class="col-xl-12">
                                <div class="form-group">
                                    <button mat-raised-button  class="dialogbtn" (click)="openItemDialog()">Items</button>

                                </div>
                                <p *ngIf="items.length>0">
                                  {{ items.length }} Items Selected
                                </p>
                              </div>
                            </div>
                            </div>
                            </div>




                    <div class="row" >
                       <div class="col-xl-6">
                          <div class="form-group">
                            <mat-form-field appearance="fill">
                              <label>Booking Channel</label>
                              <mat-select placeholder="bookingChannel" formControlName="bookingChannel" [multiple]="true">
                                <mat-option *ngFor=" let mode of bookingMode" [value]="mode.value">
                                  {{mode.displayName}}
                                </mat-option>
                                </mat-select>
                            </mat-form-field>
                          </div>
                        </div>
                        </div>
                    </div>

                    <!--end: Wizard Step 3-->




                    <!--begin: Wizard Actions-->
                    <div class="d-flex justify-content-between border-top mt-5 pt-10">
                      <div class="mr-2">
                        <button type="button" *ngIf="step == 2 || step == 3" class="btn btn-light-primary font-weight-bold text-uppercase px-9 py-4"
                          (click)="gotoPrevious()">
                          Previous
                        </button>
                      </div>
                      <div>
                        <button type="submit" *ngIf="step == 3" class="btn btn-success font-weight-bold text-uppercase px-9 py-4">
                          Submit
                        </button>
                        <button type="button" *ngIf="step == 1 || step == 2" class="btn btn-primary font-weight-bold text-uppercase px-9 py-4" (click)="gotoNext()">
                          Next
                        </button>
                      </div>
                    </div>
                    <!--end: Wizard Actions-->
                  </form>
                  <!--end: Wizard Form-->
                </div>
              </div>
              <!--end: Wizard Body-->
            </div>
            <!--end: Wizard-->
          </div>
        </div>
      </div>
      <!--end::Container-->
    </div>
    <!--end::Entry-->
  </section>
