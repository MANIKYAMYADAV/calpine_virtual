<section>
  <app-provider-subheader [isCheckin]="isCheckin" [activeTab]="'settings'"></app-provider-subheader> <!-- Subheader section -->
  <app-breadcrumb [breadcrumbs]="breadcrumbs"></app-breadcrumb>
</section>
<section class="dashboard report">
  <div class="container">
    <div class="row">
      <div class="card w-dta">
        <div class="dash-list">
          <h6>{{reimburse_report_cap}}</h6>
          <mat-accordion>
            <mat-expansion-panel [expanded]="open_filter === true" [disabled]="'true'">
              <mat-expansion-panel-header class="fltr" [collapsedHeight]="'40px'" [expandedHeight]="'40px'">

                  <span>
                      <i class="icon-filter-one" (click)="toggleFilter()" *ngIf="open_filter === true" [matTooltipClass]="tooltipcls" [matTooltip]="'Close filter window'"></i>
                      <i class="icon-filter-one" (click)="toggleFilter()" [matTooltipClass]="tooltipcls" [matTooltip]="filtericonTooltip" *ngIf="open_filter === false"></i>
                    </span>
                    <span class="clear-filter" *ngIf="filterapplied" (click)="clearFilter()" [matTooltipClass]="tooltipcls" [matTooltip]="'Reset filter'">
                      </span>


             

              </mat-expansion-panel-header>
              <div class="check_in_date end_date">
                <label class="col-form-label" for="displayName">{{date_from_cap}}</label>
                <mat-form-field>
                  <input matInput [(ngModel)]="filter.from_date" [matDatepicker]="picker" (dateChange)="checkFilterDateMaxMin('from_date')"
                    [min]="filter_date_start_min" [max]="filter_date_start_max" autocomplete="off">
                  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                  <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>
              </div>
              <div class="check_in_date end_date">
                <label class="col-form-label" for="displayName">{{date_to_cap}}</label>
                <mat-form-field>
                  <input matInput [(ngModel)]="filter.to_date" [matDatepicker]="picker1" (dateChange)="checkFilterDateMaxMin('to_date')"
                    [min]="filter_date_end_min" [max]="filter_date_end_max" autocomplete="off">
                  <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                  <mat-datepicker #picker1></mat-datepicker>
                </mat-form-field>
              </div>
              <div class="form-group pay_status">
                <label class="col-form-label" for="displayName">{{status_cap}}</label>
                <mat-form-field>
                  <mat-select [(value)]="filter.pay_status" #Fstatus>
                    <mat-option (click)="setFilterData('status', 'all')" [value]="'all'">
                      {{all_cap}}
                    </mat-option>
                    <mat-option *ngFor="let status of report_status_filter" (click)="setFilterData('status', status.value)"
                      [value]="status.value">
                      {{status.displayName}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </mat-expansion-panel>
          </mat-accordion>
          <div class="table-outer d-tbl" *ngIf="couponreport.length != 0">
            <table class="table">
              <thead>
                <tr>
                  <th>{{report_id_cap}}</th>
                  <th>{{time_period_cap}}</th>
                  <th>{{coup_use_cap}}</th>
                  <th>{{j_acc_cap}}</th>
                  <th>{{coupon_amt_cap}}</th>
                  <th>{{reimburse_amt_cap}}</th>
                  <th>{{status_cap}}</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let report of couponreport">
                  <td data-title="Report Id" class="name pointer-cursor" (click)="reportView(report.invoiceId)">{{report.invoiceId}}</td>
                  <td data-title="Time Period">{{formatDateDisplay(report.reportFromDate)}}
                    - {{formatDateDisplay(report.reportEndDate)}}</td>
                  <td data-title="Coupons Used">
                    <span *ngIf="!report.listOfJaldeeCoupons">-</span>
                    <span *ngIf="report.listOfJaldeeCoupons">
                        <span *ngFor="let jcoupon of getJSONfromString(report.listOfJaldeeCoupons) | keyvalue">
                            {{jcoupon.key}}
                        </span>
                    </span>
                  </td>
                  <td data-title="Jaldee Bank">{{report.subTotalJaldeeBank}}</td>
                  <td data-title="Coupon Amount">{{report.subTotalJaldeeCoupons}}</td>
                  <td data-title="Reimbursable Amount">{{report.grantTotal}}</td>
                  <td data-title="Status">
                    {{report_statuses[report.status]}}
                  </td>
                  <td class="action">
                    <span class="mbt" *ngIf="report.status=='PAYMENTPENDING'">
                      <button type="button" mat-icon-button [matMenuTriggerFor]="menu">
                        <mat-icon>more_vert</mat-icon>
                      </button>
                      <mat-menu #menu="matMenu">
                        <button type="button" (click)="openrequestModal(report.invoiceId)" mat-menu-item>
                          <span>{{req_payment_cap}}</span>
                        </button>
                      </mat-menu>
                    </span>
                    <span class="mbt-mobile-show" *ngIf="report.status=='PAYMENTPENDING'">
                      <button type="button" (click)="openrequestModal(report.invoiceId)">{{req_payment_cap}}</button>
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
            <div class="search_paging">
              <app-pager [total_pages]="pagination.totalCnt" [pagesize]="pagination.perPage" (pagerclick)="handle_pageclick($event)"
                [curpage]="pagination.startpageval"></app-pager>
            </div>
          </div>
        </div>
        <ng-container>
          <div class="qlst no-dta" *ngIf="couponreport.length == 0">
            {{no_reports_msg}}
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</section>
