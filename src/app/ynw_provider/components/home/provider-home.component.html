
<section>
  <app-provider-subheader [activeTab]="'dashboard'" (reloadActionSubheader)="reloadActionSubheader($event)"></app-provider-subheader> <!-- Subheader section -->
</section>
<section class="dashboard">
  <div class="container">
      <div class="row">
          <div class="card p0 w-dta">
              <div class="head">
                  <div class="locn" *ngIf="selected_location">
                      <span class="loc-name" *ngIf="!edit_location">{{selected_location.place}}</span>
                      <span class="icon-edit" (click)="editLocation()" *ngIf="!edit_location"></span>

                        <mat-form-field class="example-full-width" *ngIf="edit_location">

                          <mat-select placeholder="Locations" [(value)]="selected_location_index" (change)="onChangeLocationSelect($event)">
                            <mat-option *ngFor="let location of locations;let i = index" [value]="i">
                              {{ location.place }}
                            </mat-option>
                          </mat-select>

                        </mat-form-field>
                        <span class="icon-close" (click)="cancellocationChange()" *ngIf="edit_location"></span>

                  </div>
                  <div class="links"  *ngIf="selected_location">
                      <span class="lnk" (click)="setTimeType(1)" [ngClass]="{'active': time_type==1}">
                        Today <span class="count">{{today_waitlist_count}}</span>
                      </span>
                      <span class="lnk" (click)="setTimeType(2)" [ngClass]="{'active': time_type==2}">
                        Future <span class="count">{{future_waitlist_count}}</span></span>
                      <span class="lnk" (click)="setTimeType(0)" [ngClass]="{'active': time_type==0}">
                        History</span>
                  </div>
              </div>

              <div class="qlst" *ngIf="time_type ==1 && queues.length != 0">
                  <ul>
                      <li
                      [ngClass]="{'active': (selected_queue && queue.id == selected_queue.id )}"
                      *ngFor="let queue of queues">
                        <div class="qname"  (click)="selectedQueue(queue)">
                          <span class="qtitle"> {{queue.name}}</span>
                          <!-- <span class="qtitle" *ngIf="queue && queue.queueSchedule && queue.queueSchedule.timeSlots">
                            {{queue.queueSchedule.timeSlots[0].sTime }} - {{queue.queueSchedule.timeSlots[0].eTime }}
                          </span> -->
                        </div>
                      </li>
                  </ul>
              </div>

              <div class="dash-list">
                  <div class="ctrls">
                      <ul>
                          <li [ngClass]="{'active': status_type =='all'}"  (click)="changeStatusType('all')"
                          *ngIf="time_type != 1 || (time_type ==1 && selected_queue!=null && selected_queue.id)">
                          <span>Check-Ins</span>
                          </li>
                          <ng-container  *ngIf="time_type ==1 && selected_queue!=null && selected_queue.id">
                            <li [ngClass]="{'active': status_type =='started'}"  (click)="changeStatusType('started')">
                              <span>Started</span></li>
                            <li [ngClass]="{'active': status_type =='done'}"  (click)="changeStatusType('done')">
                              <span>Completed</span></li>
                            <li [ngClass]="{'active': status_type =='cancelled'}"  (click)="changeStatusType('cancelled')">
                              <span>Cancelled</span></li>
                          </ng-container>
                      </ul>

                      <span *ngIf="time_type ==1 && selected_queue!=null && selected_queue.id"
                      class="ml-auto cs-btn bt5" (click)="showAdjustDelay()">
                          Adjust Delay <i class="icon-question"></i>
                      </span>
                  </div>

                  <!-- <div class="fltr" *ngIf="check_in_filtered_list.length != 0">
                      <span><i class="icon-filter-one"></i></span>
                  </div> -->
                  <mat-accordion >
                    <mat-expansion-panel [expanded]="open_filter === true" [disabled]="'true'">
                      <mat-expansion-panel-header class="fltr" [collapsedHeight]="'40px'" [expandedHeight]="'40px'">
                          <span (click)="toggleFilter()"><i class="icon-filter-one"></i></span>
                      </mat-expansion-panel-header>

                      <div class="form-group first_name">
                        <mat-form-field class="example-full-width">
                          <label class="col-form-label">First name</label>
                          <input matInput [(ngModel)]="filter.first_name"  (blur)="doSearch()">
                        </mat-form-field>
                      </div>

                      <div class="form-group queues" *ngIf="time_type !== 1">
                        <label class="col-form-label" for="displayName">Queues</label>
                        <mat-chip-list>
                          <mat-chip
                          color="{{(filter.queue === 'all') ? 'primary' : ''}}"
                          selected="{{(filter.queue === 'all' )? true : false}}"
                          (click)="setFilterData('queue', 'all')">All</mat-chip>

                          <mat-chip
                          color="{{(filter.queue === queue.id) ? 'primary' : ''}}"
                          selected="{{(filter.queue === queue.id )? true : false}}"
                          *ngFor="let queue of all_queues" (click)="setFilterData('queue', queue.id)">
                              {{queue.queueSchedule.timeSlots[0].sTime }} - {{queue.queueSchedule.timeSlots[0].eTime }}
                          </mat-chip>

                        </mat-chip-list>
                      </div>

                      <div class="form-group services">
                        <label class="col-form-label" for="displayName">Services</label>
                        <mat-chip-list>
                          <mat-chip
                          color="{{(filter.service === 'all') ? 'primary' : ''}}"
                          selected="{{(filter.service === 'all' )? true : false}}"
                          (click)="setFilterData('service', 'all')">All</mat-chip>
                          <mat-chip
                          color="{{(filter.service === service.id) ? 'primary' : ''}}"
                          selected="{{(filter.service === service.id )? true : false}}"
                          (click)="setFilterData('service', service.id)"
                          *ngFor="let service of services">
                              {{service.name}}
                          </mat-chip>
                        </mat-chip-list>
                      </div>

                      <div class="form-group waitlist_status" *ngIf="time_type !== 1">
                        <label class="col-form-label" for="displayName">Waitlist Status</label>
                        <mat-chip-list>
                          <mat-chip
                          color="{{(filter.waitlist_status === 'all') ? 'primary' : ''}}"
                          selected="{{(filter.waitlist_status === 'all' )? true : false}}"
                          (click)="setFilterData('waitlist_status', 'all')">All</mat-chip>

                          <mat-chip
                          color="{{(filter.waitlist_status === status.value) ? 'primary' : ''}}"
                          selected="{{(filter.waitlist_status === status.value )? true : false}}"
                          (click)="setFilterData('waitlist_status', status.value)" *ngFor="let status of waitlist_status">
                              {{status.name}}
                          </mat-chip>
                        </mat-chip-list>
                      </div>

                      <div class="check_in_date" *ngIf="time_type !== 1">
                        <label class="col-form-label" for="displayName">Check-In Date</label>
                        <mat-form-field>
                            <input matInput [(ngModel)]="filter.check_in_date" [matDatepicker]="picker"
                            (dateChange)="doSearch()" [min]="filter_date_min" [max]="filter_date_max">
                            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-datepicker #picker></mat-datepicker>
                          </mat-form-field>
                      </div>

                    </mat-expansion-panel>
                  </mat-accordion>
                  <div class="table-outer d-tbl" *ngIf="check_in_filtered_list.length != 0">
                      <table class="table">
                          <thead>
                              <tr>
                                  <th></th>
                                  <th>Seq No</th>
                                  <th>Name</th>
                                  <th>Service</th>
                                  <th>Actions</th>
                                  <th>Payment Status</th>
                                  <th>Message</th>
                                  <th>Consumer Note</th>
                                  <th></th>
                              </tr>
                          </thead>
                          <tbody>
                              <tr  *ngFor="let checkin of check_in_filtered_list">
                                  <td class="online">
                                    <span class="icon-cloud" *ngIf="checkin.waitlistedBy == 'CONSUMER'"></span>
                                  </td>
                                  <td data-title="Seq No" class="seq pointer-cursor" (click)="goCheckinDetail(checkin)">#{{checkin.token}}</td>
                                  <td data-title="Name" class="name" *ngIf="checkin.consumer">
                                    {{checkin.consumer.userProfile.firstName}}  {{checkin.consumer.userProfile.lastName}}
                                    <span class="icon-arrived" title="Arrived"  *ngIf="checkin.waitlistStatus == 'arrived'">
                                      <span class="arrived">Arrived</span>
                                    </span>
                                  </td>
                                  <td data-title="Service" class="service">{{checkin.service.name}}</td>
                                  <td data-title="Actions" class="actions">

                                    <ng-container *ngIf="time_type == 1">
                                        <span class="arrived cs-btn bt7" (click)="changeWaitlistStatus(checkin, 'REPORT')"
                                        *ngIf="checkin.waitlistStatus == 'checkedIn'">
                                          <i class="icon-arrived"></i> Arrived
                                        </span>

                                        <span class="start cs-btn bt7" (click)="changeWaitlistStatus(checkin, 'STARTED')"
                                        *ngIf="(checkin.waitlistStatus == 'checkedIn'
                                        || checkin.waitlistStatus == 'arrived')">
                                          <i class="icon-play"></i>Start
                                        </span>

                                        <span class="done cs-btn bt7" (click)="changeWaitlistStatus(checkin, 'DONE')"
                                        *ngIf="checkin.waitlistStatus == 'started'">
                                          <i class="icon-play"></i>Done
                                        </span>

                                    </ng-container>

                                    <span class="cs-btn bt7" (click)="getWaitlistBill(checkin, 'bill')"
                                    *ngIf="checkin.waitlistStatus != 'checkedIn' &&
                                    checkin.waitlistStatus != 'cancelled' && time_type !== 2
                                    && ((time_type === 0 && checkin.billStatus) || time_type != 0)"
                                    [ngClass]="{'newbill': !checkin.billStatus, 'viewbill': checkin.billStatus }">

                                     <ng-container *ngIf="!checkin.billStatus">
                                        <i class="icon-play" ></i>New Bill
                                     </ng-container>
                                     <ng-container *ngIf="checkin.billStatus== 'Settled' || checkin.billStatus== 'New'">
                                        <i class="icon-play" ></i>View Bill
                                     </ng-container>

                                    </span>

                                    <span class="acceptbill cs-btn bt7"
                                    *ngIf="checkin.billStatus== 'New' && checkin.billPaymentStatus!='FullyPaid' " (click)="getWaitlistBill(checkin, 'payment')">
                                     <i class="icon-play" ></i>Accept payment

                                    </span>

                                    </td>
                                  <td data-title="Payment Status" class="payment">
                                    <ng-container *ngIf="checkin.paymentStatus">
                                        <span class="paid-n" *ngIf="checkin.paymentStatus == 'NotPaid'"><span class="text">Not Paid</span></span>
                                        <span class="paid-h" *ngIf="checkin.paymentStatus == 'PartiallyPaid'"><span class="text">Partially Paid</span></span>
                                        <span class="paid-f" *ngIf="checkin.paymentStatus == 'FullyPaid'"><span class="text">Paid</span></span>

                                    </ng-container>
                                  </td>
                                  <td data-title="Message" class="message">
                                    <span (click)="addConsumerInboxMessage(checkin)"><i class="icon-message"></i></span></td>
                                  <td data-title="Consumer Note" class="cnote">
                                    <span *ngIf="checkin.consumerNote" (click)="showConsumerNote(checkin)">
                                      <i class="icon-note"></i>
                                    </span>
                                  </td>
                                  <td class="mre"><span class="mbt">
                                      <button type="button" mat-icon-button [matMenuTriggerFor]="menu">
                                          <mat-icon>more_vert</mat-icon>
                                      </button>
                                      <mat-menu #menu="matMenu">
                                          <button type="button" mat-menu-item
                                          (click)="addProviderNote(checkin)">
                                            Add Provider Note
                                          </button>
                                          <button type="button" mat-menu-item
                                          (click)="changeWaitlistStatus(checkin, 'CANCEL')"
                                          *ngIf="time_type!=0 &&
                                          ( checkin.waitlistStatus == 'checkedIn' || checkin.waitlistStatus == 'arrived')">
                                            Cancel Check In
                                          </button>
                                          <button type="button" mat-menu-item
                                          (click)="changeWaitlistStatus(checkin, 'REPORT')"
                                          *ngIf="time_type!=0 &&
                                          (checkin.waitlistStatus == 'cancelled' || checkin.waitlistStatus == 'started')">
                                            Change Status to Arrived
                                          </button>
                                          <button type="button" mat-menu-item
                                          (click)="changeWaitlistStatus(checkin, 'CHECK_IN')"
                                          *ngIf="time_type!=0 &&
                                          (checkin.waitlistStatus == 'cancelled' || checkin.waitlistStatus == 'arrived' ||
                                          checkin.waitlistStatus == 'started')">
                                            Change Status to Check In
                                          </button>
                                      </mat-menu>
                                  </span>
                                </td>
                              </tr>
                              <!-- <tr>
                                  <td class="online"></td>
                                  <td data-title="Seq No" class="seq">#6</td>
                                  <td data-title="Name" class="name">Sony Joy</td>
                                  <td data-title="Service" class="service">Service Name</td>
                                  <td data-title="Actions" class="actions">
                                      <span class="arrived cs-btn bt7"><i class="icon-arrived"></i> Arrived</span> <span class="start cs-btn bt7"><i class="icon-play"></i>Start</span>
                                  </td>
                                  <td data-title="Payment Status" class="payment"><span class="paid-n"><span class="text">Not Paid</span></span> <span class="paid-h"><span class="text">Partially Paid</span></span> <span class="paid-f"><span class="text">Paid</span></span></td>
                                  <td data-title="Message" class="message"><span><i class="icon-message"></i></span></td>
                                  <td data-title="Consumer Note" class="cnote"><span><i class="icon-note"></i></span></td>
                                  <td class="mre"><span class="mbt"></span></td>
                              </tr>
                              <tr>
                                  <td class="online"><span class="icon-cloud"></span></td>
                                  <td data-title="Seq No" class="seq">#4</td>
                                  <td data-title="Name" class="name">Nithin Skariah <span class="icon-arrived" title="Arrived"></span></td>
                                  <td data-title="Service" class="service">Service Name</td>
                                  <td data-title="Actions" class="actions">
                                      <span class="start cs-btn bt7"><i class="icon-play"></i>Start</span>
                                  </td>
                                  <td data-title="Payment Status" class="payment"><span class="paid-n"><span class="text">Not Paid</span></span> <span class="paid-h"><span class="text">Partially Paid</span></span> <span class="paid-f"><span class="text">Paid</span></span></td>
                                  <td data-title="Message" class="message"><span><i class="icon-message"></i></span></td>
                                  <td data-title="Consumer Note" class="cnote"><span><i class="icon-note"></i></span></td>
                                  <td class="mre"><span class="mbt"></span></td>
                              </tr> -->
                          </tbody>
                      </table>


                    <div class="search_paging">
                      <app-pager [total_pages]="pagination.totalCnt" [pagesize]="pagination.perPage" (pagerclick)="handle_pageclick($event)" [curpage]="pagination.startpageval"></app-pager>
                    </div>

                  </div>
                  <ng-container *ngIf="time_type != 1 || (time_type ==1 && queues.length !=0)">
                    <div class="qlst no-dta" *ngIf="load_waitlist ==1 && check_in_filtered_list.length == 0">
                      No check-ins available
                    </div>
                  </ng-container>

              </div>

              <div class="qlst no-dta"
              *ngIf="time_type ==1 && load_queue == 1 &&
              queues.length ==0">
                <p>No queues available</p>
              </div>
          </div>
      </div>
  </div>
</section>
