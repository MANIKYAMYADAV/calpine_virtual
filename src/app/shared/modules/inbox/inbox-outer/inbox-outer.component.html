<section class="container cons-inbox no-padding-small">
  <div class="content comn-cls m0 p0">
    <div class="panel panel-default">
      <div class="panel-heading top-row ">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 no-padding">
          <app-header *ngIf="shared_functions.checkLogin()"></app-header>
        </div>
      </div>
      <div class="panel-body no-padding">
        <div class="c-outer m0 p0">
          <div class="c-body">
            <div class="card title-gb">
              <h5 class="mgn-up-10 bold">Inbox <a class="pull-right back-btn" (click)="goBack()"><i
                    class="fa fa-arrow-left"></i></a></h5>
            </div>
            <div class="card p0">
              <app-common-innerloading-spinner *ngIf="loading"></app-common-innerloading-spinner>
              <div class="d-flex flex-column flex-column-fluid" id="kt_content" *ngIf="!loading">
                <!--begin::Entry-->
                <div class="d-flex flex-column-fluid">
                  <!--begin::Container-->
                  <div class=" container no-padding">
                    <!--begin::Chat-->
                    <div class="d-flex flex-row">
                      <!--begin::Aside-->
                      <div class="flex-row-auto card-width w-xl-400px" id="kt_chat_aside" *ngIf="!showChat">
                        <!--begin::Card-->
                        <div class="card card-custom">
                          <!--begin::Body-->
                          <div class="card-body">
                            <!--begin:Users-->
                            <div class="mt-7 scroll scroll-pull over-scroll" [ngStyle]="{'height.vh': 75}">
                              <!--begin:User-->
                              <div *ngFor="let user of groupedMsgs | keyvalue: valueOrder"
                                (click)="providerSelection(user)"
                                class="d-flex align-items-center justify-content-between pointer-cursor pad-5"
                                [class.selected-user]="selectedProvider==user.key">
                                <div class="d-flex align-items-center">
                                  <div class="symbol symbol-circle symbol-50 mr-3">
                                    <div class="user-name">
                                      {{getUserName(user.key) | uppercase}}
                                    </div>
                                  </div>
                                  <div class="d-flex flex-column">
                                    <a class="text-dark-75 text-hover-primary font-weight-bold font-size-lg">
                                      {{user.key}}</a>
                                    <span class="text-muted font-weight-bold font-size-sm">
                                      {{formatDateDisplay(user.value[user.value.length-1].timeStamp)}}</span>
                                  </div>
                                </div>
                                <div class="d-flex flex-column align-items-end">
                                  <span class="label label-sm label-success"
                                    *ngIf="getUnreadCount(user.value) > 0">{{getUnreadCount(user.value)}}</span>
                                </div>
                              </div>
                              <!--end:User-->
                            </div>
                            <!--end:Users-->
                          </div>
                          <!--end::Body-->
                        </div>
                        <!--end::Card-->
                      </div>
                      <!--end::Aside-->
                      <!--begin::Content-->
                      <div class="flex-row-fluid ml-lg-8" id="kt_chat_content"
                        *ngIf="(selectedProvider != '' && !small_device_display) || (small_device_display && showChat)">
                        <!--begin::Card-->
                        <div class="card card-custom">
                          <!--begin::Header-->
                          <div class="card-header align-items-center px-4 py-3">
                            <div class="text-center flex-grow-1">
                              <div class="text-left flex-grow-1">
                                <!--begin::Aside Mobile Toggle-->
                                <i (click)="showChatSection()" class="fa fa-arrow-left pointer-cursor d-md-none"></i>
                                <!--end::Aside Mobile Toggle-->
                              </div>
                              <div class="text-dark-75 font-weight-bold font-size-h5">
                                {{selectedProvider}}</div>
                            </div>
                          </div>
                          <!--end::Header-->
                          <!--begin::Body-->
                          <div class="card-body no-padding-small">
                            <!--begin::Scroll-->
                            <div class="scroll scroll-pull over-scroll" #scrollMe [ngStyle]="{'height.vh': 50}">
                              <!--begin::Messages-->
                              <div class="messages" *ngFor="let msg of selectedUserMessages">
                                <!--begin::Message In-->
                                <div *ngIf="msg.owner.id!==userDet.id"
                                  class="d-flex flex-column mb-5 align-items-start">
                                  <div class="d-flex align-items-center">
                                    <div>
                                      <span class="text-muted font-size-sm">{{formatDateDisplay(msg.timeStamp)}}</span>
                                    </div>
                                  </div>
                                  <div
                                    class="mt-2 rounded p-5 bg-light-success text-dark-50 font-weight-bold font-size-lg text-left msg-width">
                                    {{msg.msg}}
                                    <div class="thumbnails mt10 mb10" *ngIf="msg.attachements">
                                      <a class="mg-10" (click)="openImage(msg.attachements, i)"
                                        *ngFor="let attachment of msg.attachements;let i=index"><img
                                          [src]="getThumbUrl(attachment)" /></a>
                                    </div>

                                  </div>
                                </div>
                                <!--end::Message In-->
                                <!--begin::Message Out-->
                                <div *ngIf="msg.owner.id==userDet.id" class="d-flex flex-column mb-5 align-items-end">
                                  <div class="d-flex align-items-center">
                                    <div>
                                      <span class="text-muted font-size-sm">{{formatDateDisplay(msg.timeStamp)}}</span>
                                    </div>
                                  </div>
                                  <div
                                    class="mt-2 rounded p-5 bg-light-primary text-dark-50 font-weight-bold font-size-lg text-right msg-width">
                                    {{msg.msg}}
                                    <div class="thumbnails mt10 mb10" *ngIf="msg.attachements">
                                      <a class="mg-10" (click)="openImage(msg.attachements, i)"
                                        *ngFor="let attachment of msg.attachements;let i=index"><img
                                          [src]="getThumbUrl(attachment)" /></a>
                                    </div>
                                  </div>
                                </div>
                                <!--end::Message Out-->
                              </div>
                              <!--end::Messages-->
                            </div>
                            <!--end::Scroll-->
                          </div>
                          <!--end::Body-->
                          <!--begin::Footer-->
                          <div class="card-footer align-items-center">
                            <!--begin::Compose-->
                            <div class="d-flex align-items-center justify-content-between mt-5">
                              <textarea class="form-control border-0 p-0" placeholder="Type a message"
                                [(ngModel)]="message"></textarea>
                              <div class="mr-3">
                                <input #logofile type="file" accept="/*;capture=camera" style="display:none;" multiple
                                  (change)="filesSelected($event)">
                                <a class="btn btn-clean btn-icon btn-md" (click)="logofile.click()"><i
                                    class="material-icons">attach_file</i></a>
                              </div>
                              <div>
                                <button type="button" (click)="sendMessageCompleted && sendMessage()"
                                  *ngIf="!small_device_display"
                                  class="btn btn-primary btn-md text-uppercase font-weight-bold chat-send py-2 px-6 disp-flex">Send
                                </button>
                                <i *ngIf="small_device_display" (click)="sendMessageCompleted && sendMessage()"
                                  class="fa fa-paper-plane" aria-hidden="true"></i>
                              </div>
                            </div>
                            <div class="img-section mgn-up-20"
                              *ngIf="selectedMessage.files && selectedMessage.files.length > 0">
                              <ul class="galul">
                                <li *ngFor="let file of selectedMessage.files;let i = index ">
                                  <div class="galimg_outer">
                                    <div class="gal_img">
                                      <img [src]="selectedMessage.base64[i]" *ngIf="selectedMessage.base64[i]">
                                    </div>
                                    <div class="gal_action" (click)="deleteTempImage(i)">
                                      <i class="fa fa-times-circle" aria-hidden="true"></i>
                                    </div>
                                  </div>
                                </li>
                              </ul>
                            </div>
                            <!--begin::Compose-->
                          </div>
                          <!--end::Footer-->
                        </div>
                        <!--end::Card-->
                      </div>
                      <!--end::Content-->
                    </div>
                    <!--end::Chat-->
                  </div>
                  <!--end::Container-->
                </div>
                <!--end::Entry-->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<ks-modal-gallery [id]="0" *ngIf="image_list_popup && image_list_popup.length>0" [modalImages]="image_list_popup"
  [plainGalleryConfig]="customPlainGalleryRowConfig" [buttonsConfig]="customButtonsFontAwesomeConfig"
  (buttonBeforeHook)="onButtonBeforeHook()" (buttonAfterHook)="onButtonAfterHook()"></ks-modal-gallery>