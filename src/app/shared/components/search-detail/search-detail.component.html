<app-header [headerTitle]="'Header'"></app-header>
<p>
 Search Result
</p>
<!-- <app-search *ngIf="showsearchsection" [showopennow]="0" [searchfields] = "setfields()" (searchclick)="handlesearchClick($event)"></app-search> -->
<app-search *ngIf="showsearchsection" [showopennow]="0" [searchfields] = "searchfields" [subdomainpassedfromrefined]="subdomainleft" [domainpassedfromrefined]="domain"  (searchclick)="handlesearchClick($event)"></app-search>
<table class="table">
  <tr>
    <td class="lefttd">
      <div class="refine_outer">Refine Search</div>
      <div *ngIf="searchrefine_arr.length>0 && arraycreatedfromquerystring">
        <div *ngIf="domainlist_data && kwtyp != 'subdom'">
          <div class="refine_subheader">Select Domain</div>
          <mat-form-field>
              <div>
                <mat-select placeholder="" [(ngModel)]="domain" #leftseldomain (change)="handleleftdomainchange(leftseldomain.value)" >
                  <mat-option value="">--  Select --</mat-option>
                  <mat-option *ngFor="let domain of domainlist_data" [value]="domain.domain" >
                    {{ domain.displayName }}
                  </mat-option>
                </mat-select>
              </div>
            </mat-form-field>
        </div>
        <div *ngIf="subdomainlist_data && kwtyp != 'subdom' && domain">
            <div class="refine_subheader">Select Sub Domain</div>
            <mat-form-field>
                <div>
                  <mat-select placeholder="" [(ngModel)]="selected_leftsubdomain" #leftselsubdomain (change)="handleleftsubdomainchange(leftselsubdomain.value)" >
                    <mat-option value="">--  Select --</mat-option>
                    <mat-option *ngFor="let sdomain of subdomainlist_data" [value]="sdomain.subDomain" >
                      {{ sdomain.displayName }}
                    </mat-option>
                  </mat-select>
                </div>
              </mat-form-field>
        </div>    

        <div *ngFor="let refine_data of searchrefine_arr">
            <div class="refine_subheader">{{refine_data.displayName}}</div>
              <div class="refine_fieldlist">
                
                
                <div *ngIf="refine_data.dataType=='TEXT' || refine_data.dataType=='TEXT_MED'" >
                    <!-- <input type="text" placeholder="" name="{{refine_data.name}}"/> -->
                    <mat-form-field class="example-full-width">
                      <input matInput placeholder="Enter {{refine_data.displayName}}" [value]="returnRefineCheckboxRetainValue(refine_data.cloudSearchIndex, '', refine_data.dataType)" (blur)="handleTextrefineblur(refine_data.cloudSearchIndex	,$event.target.value,refine_data.dataType, false)">
                    </mat-form-field>
                    <span class="glyphicon glyphicon-search"></span>
                </div>
                
                <div *ngIf="refine_data.dataType=='EnumList' || refine_data.dataType=='Enum'">
                    <div *ngIf="refine_data.enumeratedConstants.length>0">
                        <div class="refine_field_subouter" *ngFor="let refine_field of refine_data.enumeratedConstants">
                          <!-- <input type="checkbox" name="{{refine_field.name}}" value="{{refine_field.name}}"/> -->
                          <mat-checkbox [checked]="returnRefineCheckboxRetainValue(refine_data.cloudSearchIndex, refine_field.name, refine_data.dataType)" class="example-margin" (change)="handle_optionclick(refine_data.cloudSearchIndex	,refine_data.dataType,refine_field.name,false)">{{refine_field.displayName}}</mat-checkbox>
                          
                        </div>
                    </div>
                </div> 

                <!-- <div *ngIf="refine_data.dataType=='Enum'">  
                  <div *ngIf="refine_data.enumeratedConstants.length>0">
                      
                        <div class="refine_field_subouter">
                          <mat-radio-group class="example-radio-group">
                            <mat-radio-button class="example-radio-button"  (change)="handle_optionclick(refine_data.name,refine_data.dataType,refine_field.name, false)" [value]="refine_field.name" *ngFor="let refine_field of refine_data.enumeratedConstants">
                              {{refine_field.displayName}}
                            </mat-radio-button>
                          </mat-radio-group>  
                        </div>
                      
                  </div>
              </div> -->

                <div *ngIf="refine_data.dataType=='Boolean'">
                  <mat-slide-toggle #{{refine_data.name}}  [checked]="returnRefineCheckboxRetainValue(refine_data.cloudSearchIndex, '', refine_data.dataType)" (change)="handle_optionclick(refine_data.cloudSearchIndex,refine_data.dataType,1,false)">{{refine_data.displayName}}</mat-slide-toggle>
                </div>  
                
                <div *ngIf="refine_data.dataType=='Rating'">
                  <app-rating-star  [cloudindex]="refine_data.cloudSearchIndex" [ratingval]="returnRefineCheckboxRetainValue(refine_data.cloudSearchIndex, '', refine_data.dataType)" (ratingreturn)="handleratingClick($event)"></app-rating-star>
                </div> 
                
              </div>
        </div>
      </div>
    </td>
    <td class="righttd">
        <div class='search_result_outer'>

          <div *ngIf="searchrefineresult_arr.length>0">
              <div *ngFor="let result of searchrefineresult_arr">
                  {{result}}
              </div>
          </div>


            <div><button (click)="goback()">Back</button></div>
          <div *ngIf = "search_string" >{{search_string}}</div>
          <div *ngIf = "search_result_count">
            <div class="count_div">
                <div class="search_count_display"> {{search_data.hits.found}} YNW Business listings found</div>
                <div class="search_sort_display">
                  <select name="sortfield" #sortfieldsel (change)="selected_sortfield(sortfieldsel.value)">
                    <option value="title" [selected]="sortfield==='title'" >Title</option>
                    <option value="sector" [selected]="sortfield==='sector'">Sector</option>
                  </select>
                  <span class="sorder" (click)="selected_sortorder('asc')">A</span>&nbsp;<span  class="sorder" (click)="selected_sortorder('desc')">D</span>
                </div>
            </div>
            <div *ngFor = "let search_result of search_data.hits.hit">
        
              <div class="search_result_row">
                <div class="search_prov_logo">
                  <img *ngIf="search_result.fields.logo" [src]="showproviderlogoicon(search_result.fields.logo)"/>
                  <img *ngIf="!search_result.fields.logo" [src]="showproviderlogoicon()"/>
                </div>
                <div class="search_prov_lhs_outer">
                  <div class="search_prov_name"><a [routerLink]="[search_result.fields.unique_id]" class="search_prov_namelink">{{search_result.fields.title}}</a></div>
                  <div class="search_prov_sector">Sector - {{search_result.fields.sector}}</div>
                </div>
                <div class="search_prov_rhs_outer">
                  <div class="search_prov_place">{{search_result.fields.place1}}</div>
                  <div class="search_prov_phone">{{search_result.fields.business_phone_no}}</div>
                </div>
              </div>
        
            </div>
            <div class="search_paging">
             <app-pager [total_pages]="pass_totalpages()" [pagesize]="pass_pagesize()" (pagerclick)="handle_pageclick($event)" [curpage]="startpageval"></app-pager>
            </div>
          </div>
          <div *ngIf="nosearch_results">No YNW results found - {{nosearch_results}}</div>
        
          <!-- <div>
            Sector {{domain}}<br/>
            Sub-Sector {{subsector}}<br/>
            Specialization {{specialization}} <br/>
            Labelq {{labelq}}<br/>
            Common Filters {{commonfilters}}<br/>
          </div> -->
          <!-- <div>selection count {{searchrefineresult_arr.length}}</div>
          <div *ngFor="let srch1 of searchrefineresult_arr;">
                {{srch1}}
              
          </div> -->

        </div>
    
    </td>
  </tr>
</table>


