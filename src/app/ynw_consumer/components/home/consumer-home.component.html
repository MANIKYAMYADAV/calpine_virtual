
<section class="content consumer-dash">
  <div class="container">
      <div class="row">
          <!-- <h1>Consumer <span>Dashboard</span></h1> -->
          <div class="card c-chekins">
              <mat-accordion >
                <mat-expansion-panel [expanded]= 'true'>
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                      Current Check-Ins
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <div class="outer">
                    <div class="list" *ngFor=" let waitlist of waitlists">
                        <div class="lt">
                            <h3 class="pointer-cursor" (click)="providerDetail(waitlist.provider)">{{waitlist.provider.businessName || ''}}</h3>
                            <span class="location" *ngIf="waitlist.queue.location">
                              {{waitlist.queue.location.place || ''}}
                              <a *ngIf="waitlist.queue.location.googleMapUrl" [href]="waitlist.queue.location.googleMapUrl" target="_blank">
                                  <i data-icon="j"></i>
                              </a>
                            </span>

                            <div class="service-for"><span class="service">
                              {{waitlist.service.name}}</span> for
                              <span class="waitlist_for"
                              *ngFor="let user of waitlist.waitlistingFor">
                                  {{user.firstName}} {{user.lastName}}
                              </span>

                            </div>

                            <div class="est-time">
                              <ng-container  *ngIf="!waitlist.future">
                                <span class="ttle">
                                  Estimated Waiting Time:
                                </span>
                                <span class="time">
                                  <span class="min">{{waitlist.estimated_time }}</span>
                                </span>
                              </ng-container>

                              <ng-container  *ngIf="waitlist.future">
                                <span class="ttle">
                                  Check-In Time :
                                </span>
                                <span class="date">{{waitlist.date | date: dateFormat }}</span>
                                <span class="time">
                                  <span class="min">{{waitlist.estimated_time | date: timeFormat}}</span>
                                </span>
                              </ng-container>

                            </div>
                            <div class="token-no">
                              <span class="ttle">Token No:</span>
                              <span class="token">{{waitlist.token}}</span>
                            </div>
                            <div class="token-no">
                              <span class="ttle">Persons Ahead:</span>
                              <span class="time">{{waitlist.personsAhead}}</span>
                            </div>
                        </div>
                        <div class="rt">
                            <ul class="controls">
                                <li  (click)="addWaitlistMessage(waitlist)">
                                  <span class="message">Message</span>
                                </li>
                                <li *ngIf="!checkIfFav(waitlist.provider.id)">
                                  <span class="add-fav" (click)="addFavProvider(waitlist.provider.id)">
                                    Add to Favourites</span>
                                </li>
                                <li *ngIf="checkIfFav(waitlist.provider.id)">
                                  <span class="add-fav favourited"
                                    (click)="doDeleteFavProvider(waitlist.provider)">
                                    Remove Favourite</span>
                                </li>
                                <li *ngIf="waitlist.waitlistStatus == 'checkedIn' || waitlist.waitlistStatus == 'arrived'">
                                  <span class="cancel" (click)="doCancelWaitlist(waitlist)">Cancel Check-in</span>
                                </li>
                                <li *ngIf="waitlist.waitlistStatus == 'done'">
                                  <span class="view-bill" (click)="doCancelWaitlist(waitlist)">Bill</span>
                                </li>
                                <li *ngIf="waitlist.waitlistStatus == 'done'">
                                  <span class="rate" (click)="doCancelWaitlist(waitlist)">Rate Service</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div *ngIf="loadcomplete.waitlist && waitlists && waitlists.length == 0">
                      <p>No current Check-Ins available</p>
                    </div>

                  </div>
                </mat-expansion-panel>
                </mat-accordion>
          </div>

          <div class="card favourites">
              <mat-accordion>
                <mat-expansion-panel [expanded]= 'true'>
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                      My Favourites
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <div class="outer">
                      <div class="list" *ngFor="let provider of fav_providers">
                        <div class="header">
                            <div class="lt">
                                <h3 class="pointer-cursor" (click)="providerDetail(provider)">
                                  {{provider.businessName}}</h3>
                            </div>
                            <div class="rt">
                                <ul class="controls">
                                    <li (click)="addCommonMessage(provider)"><span class="message">Message</span></li>
                                    <li>
                                    <button mat-icon-button [matMenuTriggerFor]="appMenu">
                                      <mat-icon>more_vert</mat-icon>
                                    </button>
                                    </li>
                                </ul>
                                <mat-menu #appMenu="matMenu">
                                  <button mat-menu-item>
                                    <span class="add-fav favourited"
                                    (click)="doDeleteFavProvider(provider)">
                                    Remove Favourite</span>
                                  </button>
                                  <button mat-menu-item>Manage Privacy</button>
                                </mat-menu>
                            </div>
                        </div>
                        <div class="detail">
                          <div class="location" *ngFor="let loc of provider.locations">
                            <div>
                              {{loc.place}}
                            </div>

                            <div class="bt-l">
                              <div class="wt-tme" *ngIf="loc['estimatedtime_det']">
                                  <div class="o-now" *ngIf="loc.opennow">Open Now</div>
                                  <div class="timing" *ngIf="loc['estimatedtime_det']['caption']">
                                      <span class="est-time">{{loc['estimatedtime_det']['caption']}}</span>
                                      <span class="time-data">{{loc['estimatedtime_det']['time']}}
                                        <span class="icon-question"
                                        [matTooltip]="waitlistestimatetimetooltip"></span></span>
                                  </div>
                                  <div class="wt-msg" *ngIf="loc['estimatedtime_det']['message']">
                                    {{loc['estimatedtime_det']['message']}}</div>
                              </div>
                            </div>

                            <div class="bt-r" *ngIf="loc['estimatedtime_det']">
                                <span class="cs-btn chk-btn" (click)="goCheckin(provider, loc, false, 'fav_provider')" *ngIf="loc['estimatedtime_det']['isFuture']==2 && loc['estimatedtime_det']['queue_available']==1 && showcheckInButton(provider)">Check-In</span>
                                <span class="cs-btn chk-btn disabled" *ngIf="loc['estimatedtime_det']['isFuture']==1 || loc['estimatedtime_det']['queue_available']==0 || !showcheckInButton(provider)">Check-In</span>
                                <span class="cs-btn bt10" *ngIf="showcheckInButton(provider)" (click)="goCheckin(provider, loc, true, 'fav_provider')">
                                  Do you want to <span>Check-in</span> for <span>different Date/Time?</span>
                                </span>
                            </div>

                          </div>
                        </div>

                      </div>
                      <div *ngIf="loadcomplete.fav_provider && fav_providers && fav_providers.length == 0">
                        <p>You haven't added any favourite providers</p>
                      </div>
                  </div>
                </mat-expansion-panel>
              </mat-accordion>
          </div>

          <div class="card history">
              <mat-accordion>
                <mat-expansion-panel>
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                      History
                    </mat-panel-title>
                  </mat-expansion-panel-header>

                  <app-consumer-checkin-history-list [reloadapi]="reload_history_api">

                  </app-consumer-checkin-history-list>
                </mat-expansion-panel>
              </mat-accordion>
          </div>
      </div>
  </div>
</section>
