<section class="content consumer-dash">
  <div class="container">
        <!-- <div class="row"> -->
          <!-- <h1>Consumer <span>Dashboard</span></h1> -->
          <div class="card c-checkins">

              <h2 [matTooltipClass] = "tooltipcls" [matTooltip]="currentcheckinsTooltip">Active Check-Ins <ng-container *ngIf="waitlists">({{waitlists.length}})</ng-container></h2>
              <div class="outer">
                    <ngx-carousel [inputs]="carouselOne" (carouselLoad)="myfunc($event)" class="banner">
                    <ngx-item NgxCarouselItem *ngFor="let waitlist of waitlists" >
                    <!-- <div class="list"> -->
                            <div class="header">
                                <div class="lt">
                                    <div class="title" (click)="providerDetail(waitlist.provider)"><h3>{{waitlist.provider.businessName || '' | capitalizeFirst}}</h3></div>
                                    <div class="location" *ngIf="waitlist.queue.location">
                                        <a *ngIf="waitlist.queue.location.googleMapUrl"
                                        [href]="waitlist.queue.location.googleMapUrl" target="_blank"
                                        class="icon-location" matTooltip="Click to navigate"> {{waitlist.queue.location.place || '' | capitalizeFirst}}</a>
                                    </div>
                                    <div class="status-outer">
                                    <div class="cancel-label" *ngIf="waitlist.waitlistStatus == 'cancelled'">
                                        Cancelled
                                    </div>
                                    <div class="started-label" *ngIf="waitlist.waitlistStatus == 'started'">
                                        Started
                                    </div>
                                    <div class="done-label" *ngIf="waitlist.waitlistStatus == 'done'">
                                        Done
                                    </div>
                                    </div>
                                </div>
                                <div class="rt">
                                    <div class="favourite" *ngIf="checkIfFav(waitlist.provider.id)">
                                        <span class="icon-favourite-filled"></span>
                                    </div>
                                    <div class="favourite" *ngIf="!checkIfFav(waitlist.provider.id)">
                                        <span class="icon-favourite" matTooltip="Add to Favourite" (click)="addFavProvider(waitlist.provider.id)"></span>
                                    </div>
                                    <!-- <div class="cancel-label" *ngIf="waitlist.waitlistStatus == 'cancelled'">
                                        Cancelled
                                    </div>
                                    <div class="started-label" *ngIf="waitlist.waitlistStatus == 'started'">
                                        Started
                                    </div>
                                    <div class="done-label" *ngIf="waitlist.waitlistStatus == 'done'">
                                        Done
                                    </div> -->
                                </div>
                            </div>
                            
                            <div class="details">
                                <div class="lt">
                                    <div class="lt0">
                                        <span class="service">{{waitlist.service.name  | capitalizeFirst}}</span> for <span class="forwhom" *ngFor="let user of waitlist.waitlistingFor">
                                            {{user.firstName  | capitalizeFirst}} {{user.lastName | capitalizeFirst}}
                                            </span>
                                    </div>
                                    <ng-container *ngIf="waitlist.calculationMode != 'NoCalc' && waitlist.estimated_time && (waitlist.waitlistStatus == 'checkedIn'  ||
                                        waitlist.waitlistStatus == 'arrived')">
                                            <div class="lt0" *ngIf="waitlist.estimated_date==''">
                                                {{waitlist.estimated_caption}} <span class="time now">
                                                    {{waitlist.estimated_time}}</span>
                                            </div>
                                            <div class="lt0" *ngIf="waitlist.estimated_date!=''">
                                                {{waitlist.estimated_caption}} <span class="time now">
                                            <span *ngIf="waitlist.estimated_date_type == 'date'">{{waitlist.estimated_date | date: dateFormatSp }}</span>
                                            <span *ngIf="waitlist.estimated_date_type == 'string'">{{waitlist.estimated_date}}, </span>
                                                {{waitlist.estimated_time}}</span>
                                            </div>
                                        </ng-container>
                                    <div class="lt0" *ngIf="showPersonsAhead(waitlist)"> 
                                        Persons Ahead <span class="persons">{{waitlist.personsAhead}}</span>
                                    </div>
                                    <div class="lt0" *ngIf="waitlist.token">
                                        Token No <span class="token">{{waitlist.token}}</span>
                                    </div>
                                    <div class="lt0" *ngIf="waitlist.partySize && waitlist.partySize > 1">
                                        Party Size <span class="persons">{{waitlist.partySize}}</span>
                                    </div>
                                    <div class="lt0 payment" *ngIf="waitlist.waitlistStatus=='prepaymentPending'">
                                        <span class="paytext">{{checkindisablemsg}}</span>    
                                        <span class="buttonouter">
                                            <!-- <span class="amount">Amount to Pay: $1000</span> -->
                                            <button class="cs-btn bt3" (click)="makeFailedPayment(waitlist)">Make Payment</button>
                                        </span>
                                    </div>
                                </div>
                                <div class="rt">
                                    <ul class="controls">
                                        <li *ngIf="waitlist.billStatus"> 
                                            <span class="view-bill" (click)="getWaitlistBill(waitlist)">Bill</span>
                                            </li>
                                        <!-- <li (click)="makeFailedPayment(waitlist)" *ngIf="waitlist.waitlistStatus=='prepaymentPending'">
                                            <span class="payment">Make Payment</span>
                                            </li> -->
                                        <li (click)="addWaitlistMessage(waitlist)">
                                            <span class="message">Send Message</span>
                                        </li>
                                        <!-- <li *ngIf="!checkIfFav(waitlist.provider.id)">
                                        <span class="add-fav" (click)="addFavProvider(waitlist.provider.id)">Favourites</span></li> -->
                                        <li *ngIf="waitlist.waitlistStatus == 'checkedIn' || waitlist.waitlistStatus == 'arrived'">
                                            <span class="cancel" (click)="doCancelWaitlist(waitlist)">Cancel</span>
                                        </li>
                                        <li *ngIf="waitlist.waitlistStatus == 'done'">
                                            <span class="rate-service"  [class.rated] = "isRated(waitlist)" (click)="rateService(waitlist)">Rate Your Visit</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                    <!-- </div> -->
                    </ngx-item>
                    <button NgxCarouselPrev class='leftRs'>&lt;</button>
                    <button NgxCarouselNext class='rightRs'>&gt;</button>
              </ngx-carousel>
                <div *ngIf="loadcomplete.waitlist && waitlists && waitlists.length == 0" class="nocheckins">
                    <p>No current Check-Ins available</p>
                </div>
            </div>
                
              </div>
        <!-- </div> -->

        <div class="card favourites">
              <mat-accordion>
                <mat-expansion-panel [expanded]= 'true'>
                  <mat-expansion-panel-header>
                    <mat-panel-title  [matTooltipClass] = "tooltipcls" [matTooltip]="favTooltip">
                      My Favourites
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <div class="outer">
                      <div class="list" [class.active]="open_fav_div == i" *ngFor="let provider of fav_providers; index as i">
                        <div class="header">
                            <div class="lt"  (click)="toogleDetail(provider, i)">
                                <h3 class="pointer-cursor">
                                  {{provider.businessName | capitalizeFirst}}</h3>
                            </div>
                            <div class="rt">
                                <ul class="controls">
                                    <li (click)="addCommonMessage(provider)"><span class="message">Send Message</span></li>
                                    <li>
                                    <button mat-icon-button [matMenuTriggerFor]="appMenu">
                                      <mat-icon>more_vert</mat-icon>
                                    </button>
                                    </li>
                                </ul>
                                <mat-menu #appMenu="matMenu">
                                  <button mat-menu-item (click)="providerDetail(provider)">View</button>
                                  <button mat-menu-item (click)="doDeleteFavProvider(provider)">
                                    <span class="add-fav favourited">
                                    Remove Favourite</span>
                                  </button>
                                  <button mat-menu-item (click)="providerManagePrivacy(provider,i)">
                                      Manage Privacy
                                  </button>
                                </mat-menu>
                            </div>
                        </div>
                        <div class="detail"  [@hideShowAnimator]="hideShowAnimator" *ngIf="open_fav_div == i">
                          <div class="location" *ngFor="let loc of provider.locations;">
                            <div class="locationname">
                                <span class="icon-location"></span> {{loc.place | capitalizeFirst}}
                            </div>

                            <div class="bt-l">
                              <div class="wt-tme" *ngIf="loc['estimatedtime_det']">
                                  <div class="o-now" *ngIf="loc.opennow">Open Now</div>
                                  <div class="timing" *ngIf="loc['estimatedtime_det']['caption']
                                  && provider.settings && provider.settings.calculationMode
                                  && provider.settings.calculationMode!='NoCalc'">
                                      <span class="est-time">{{loc['estimatedtime_det']['caption']}}</span>
                                      <span class="time-data">{{loc['estimatedtime_det']['time']}}
                                        <span class="icon-question"
                                        [matTooltip]="waitlistestimatetimetooltip"></span></span>
                                  </div>
                                  <div class="wt-msg" *ngIf="loc['estimatedtime_det']['message']">
                                    {{loc['estimatedtime_det']['message']}}</div>
                              </div>

                            </div>

                            <div class="bt-r" *ngIf="loc['estimatedtime_det']">
                                <span class="cs-btn chk-btn" (click)="goCheckin(provider, loc, loc['estimatedtime_det']['cdate'], false, 'fav_provider')" *ngIf="loc['estimatedtime_det']['isFuture']==2 && loc['estimatedtime_det']['queue_available']==1 && showcheckInButton(provider)">Check-In</span>
                                <span class="cs-btn chk-btn disabled" *ngIf="loc['estimatedtime_det']['isFuture']==1 || loc['estimatedtime_det']['queue_available']==0 || !showcheckInButton(provider)">Check-In</span>
                                <span class="cs-btn bt10" *ngIf="showcheckInButton(provider) && provider.settings && provider.settings.futureDateWaitlist && loc['estimatedtime_det']['cdate']" (click)="goCheckin(provider, loc,  loc['estimatedtime_det']['cdate'], true, 'fav_provider')">
                                  Do you want to <span>Check-in</span> for <span>different Date?</span>
                                </span>
                            </div>

                          </div>
                        </div>

                      </div>
                      <div *ngIf="loadcomplete.fav_provider && fav_providers && fav_providers.length == 0">
                        <p>You haven't added any favourite providers</p>
                      </div>
                  </div>
                </mat-expansion-panel>
              </mat-accordion>
        </div>

        <div class="card history">
              <mat-accordion>
                <mat-expansion-panel>
                  <mat-expansion-panel-header>
                    <mat-panel-title [matTooltipClass] = "tooltipcls" [matTooltip]="historyTooltip">
                      History
                    </mat-panel-title>
                  </mat-expansion-panel-header>

                  <app-consumer-checkin-history-list [reloadapi]="reload_history_api">

                  </app-consumer-checkin-history-list>
                </mat-expansion-panel>
              </mat-accordion>
        </div>
  </div>
  <!-- </div> -->
</section>
<div [innerHTML]= "payment_popup" #div [style.display]="'none'"></div>
